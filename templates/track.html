{% extends "base.html" %}

{% block title %}Track Your Food - Krishi Sahayak{% endblock %}

{% block content %}
<div class="container">
    <!-- Header -->
    <div class="text-center mb-4">
        <h1 class="h2 mb-3">
            <svg width="32" height="32" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="me-2 text-success">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            🌾 Farm to Fork Journey
        </h1>
        <p class="lead text-muted">
            Know your farmer, trust your food
        </p>
    </div>

    {% if tracking_data %}
    <!-- Farmer Information -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card farmer-card">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0">
                        👨‍🌾 Meet Your Farmer
                    </h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-12 col-md-8">
                            <h3 class="text-success">{{ tracking_data.farmer.name }}</h3>
                            <p class="mb-2">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="me-1">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                <strong>{{ tracking_data.farmer.village }}</strong>
                            </p>
                            <p class="mb-2">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="me-1">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                {{ tracking_data.farmer.experience }}
                            </p>
                            <p class="mb-2">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="me-1">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                </svg>
                                <strong>Farming Method:</strong> {{ tracking_data.farmer.farming_method }}
                            </p>
                            <div class="crops-grown">
                                <strong>Crops Grown:</strong>
                                {% for crop in tracking_data.farmer.crops_grown %}
                                <span class="badge bg-success me-1">{{ crop }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="col-12 col-md-4 text-center">
                            <div class="farmer-avatar">
                                <svg width="80" height="80" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="text-success">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                            </div>
                            <p class="small text-muted mt-2">Verified Farmer</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Crop Information -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">
                        🌾 Crop Details
                    </h4>
                </div>
                <div class="card-body">
                    <div class="row g-4">
                        <div class="col-12 col-md-6">
                            <div class="crop-detail">
                                <h5>{{ tracking_data.crop.type }}</h5>
                                <p class="text-muted">{{ tracking_data.crop.variety }}</p>
                                <div class="crop-badges">
                                    {% if tracking_data.crop.organic_certified %}
                                    <span class="badge bg-success">🌿 Organic Certified</span>
                                    {% endif %}
                                    {% if tracking_data.crop.pesticide_free %}
                                    <span class="badge bg-info">🚫 Pesticide Free</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="crop-stats">
                                <div class="stat-item">
                                    <strong>Harvest Date:</strong> {{ tracking_data.crop.harvest_date }}
                                </div>
                                <div class="stat-item">
                                    <strong>Water Source:</strong> {{ tracking_data.crop.water_source }}
                                </div>
                                <div class="stat-item">
                                    <strong>Soil Type:</strong> {{ tracking_data.crop.soil_type }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Journey Timeline -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">
                        🚚 Farm to Fork Journey
                    </h4>
                </div>
                <div class="card-body">
                    <div class="timeline">
                        {% for step in tracking_data.journey %}
                        <div class="timeline-item">
                            <div class="timeline-marker"></div>
                            <div class="timeline-content">
                                <h5>{{ step.stage }}</h5>
                                <p class="text-muted mb-1">{{ step.date }}</p>
                                <p class="mb-1"><strong>{{ step.location }}</strong></p>
                                <p class="small">{{ step.description }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Certifications -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">
                        🏆 Certifications & Quality
                    </h4>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        {% for cert in tracking_data.certifications %}
                        <div class="col-12 col-md-4">
                            <div class="certification-badge">
                                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="me-2 text-success">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                {{ cert }}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    {% if tracking_data.blockchain_verified %}
                    <div class="blockchain-verification mt-3">
                        <div class="alert alert-success">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="me-2">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                            </svg>
                            <strong>Blockchain Verified:</strong> This product's journey is recorded on blockchain for complete transparency and authenticity.
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Farmer -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">
                        📞 Connect with Your Farmer
                    </h4>
                </div>
                <div class="card-body text-center">
                    <p class="mb-3">Want to know more about your food? Connect directly with the farmer!</p>
                    <div class="row g-3">
                        <div class="col-12 col-md-4">
                            <button class="btn btn-success w-100" onclick="sendFeedback()">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="me-2">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                </svg>
                                Send Feedback
                            </button>
                        </div>
                        <div class="col-12 col-md-4">
                            <button class="btn btn-outline-success w-100" onclick="shareProduct()">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="me-2">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                                </svg>
                                Share Story
                            </button>
                        </div>
                        <div class="col-12 col-md-4">
                            <button class="btn btn-outline-primary w-100" onclick="orderMore()">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="me-2">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17M17 13v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6m8 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v4.01"></path>
                                </svg>
                                Order More
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% else %}
    <!-- No tracking data found -->
    <div class="row justify-content-center">
        <div class="col-12 col-md-6">
            <div class="card">
                <div class="card-body text-center py-5">
                    <svg width="64" height="64" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="text-muted mb-3">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <h3>Product Not Found</h3>
                    <p class="text-muted mb-4">
                        The QR code you scanned doesn't match any product in our system.
                    </p>
                    <a href="{{ url_for('main.dashboard') }}" class="btn btn-primary">
                        Go to Dashboard
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_css %}
<style>
.farmer-card {
    border: 2px solid #28a745;
    box-shadow: 0 4px 15px rgba(40, 167, 69, 0.2);
}

.farmer-avatar {
    background: linear-gradient(135deg, #28a745, #20c997);
    border-radius: 50%;
    width: 100px;
    height: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
}

.farmer-avatar svg {
    color: white;
}

.crop-detail h5 {
    color: #28a745;
    font-weight: 600;
}

.crop-badges .badge {
    margin-right: 5px;
    margin-bottom: 5px;
}

.stat-item {
    margin-bottom: 8px;
    padding: 5px 0;
    border-bottom: 1px solid #eee;
}

.timeline {
    position: relative;
    padding-left: 30px;
}

.timeline::before {
    content: '';
    position: absolute;
    left: 15px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: #28a745;
}

.timeline-item {
    position: relative;
    margin-bottom: 30px;
}

.timeline-marker {
    position: absolute;
    left: -23px;
    top: 5px;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #28a745;
    border: 3px solid white;
    box-shadow: 0 0 0 2px #28a745;
}

.timeline-content h5 {
    color: #28a745;
    font-weight: 600;
    margin-bottom: 5px;
}

.certification-badge {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 15px;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 500;
}

.blockchain-verification {
    border-top: 1px solid #dee2e6;
    padding-top: 15px;
}

@media (max-width: 768px) {
    .timeline {
        padding-left: 20px;
    }
    
    .timeline-marker {
        left: -18px;
        width: 12px;
        height: 12px;
    }
    
    .farmer-avatar {
        width: 80px;
        height: 80px;
    }
}
</style>
{% endblock %}

{% block extra_scripts %}
<script>
function sendFeedback() {
    const message = prompt("Share your feedback about this product:");
    if (message) {
        alert("Thank you for your feedback! We'll share it with the farmer.");
        // In real implementation, send feedback to farmer
    }
}

function shareProduct() {
    if (navigator.share) {
        navigator.share({
            title: 'Know Your Farmer - {{ tracking_data.farmer.name if tracking_data else "Farm Product" }}',
            text: 'Check out the amazing journey of this farm product from {{ tracking_data.farmer.village if tracking_data else "farm" }} to your table!',
            url: window.location.href
        });
    } else {
        // Fallback for browsers without native sharing
        const url = window.location.href;
        navigator.clipboard.writeText(url).then(() => {
            alert("Link copied to clipboard! Share it with your friends.");
        });
    }
}

function orderMore() {
    alert("Feature coming soon! You'll be able to order directly from the farmer.");
    // In real implementation, redirect to ordering system
}

// Auto-scroll to show the journey
document.addEventListener('DOMContentLoaded', function() {
    const timeline = document.querySelector('.timeline');
    if (timeline) {
        // Add animation to timeline items
        const items = document.querySelectorAll('.timeline-item');
        items.forEach((item, index) => {
            setTimeout(() => {
                item.style.opacity = '0';
                item.style.transform = 'translateX(-20px)';
                item.style.transition = 'all 0.5s ease';
                
                setTimeout(() => {
                    item.style.opacity = '1';
                    item.style.transform = 'translateX(0)';
                }, 100);
            }, index * 200);
        });
    }
});
</script>
{% endblock %}